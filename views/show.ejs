<% layout('layouts/boilerplate.ejs') -%>

<div class="container mt-3">
    <div class="row">
        <div class="col-10 offset-1">
            <h2 class="mb-3"><b><%= listing.title %></b></h2>
        </div>

        <div class="col-10 offset-1">
            <div class="show-banner">
                <img src="<%= listing.image.url %>" class="banner-img w-100" alt="listing_image">
            </div>
        </div>

        <div class="col-10 offset-1 mt-4">
            <div class="listing-details">
                <p ><i>Hosted by <%= listing.owner.username %></i></p>
                <hr>
                <p class="description-text"><%= listing.description %></p>
                <p class="price-text">
                    <b>&#8377; <%= listing.price.toLocaleString("en-IN") %></b> / night
                </p>
                <p class="location-text">
                    <i class="fa-solid fa-location-dot"></i> <%= listing.location %>, <%= listing.country %>
                </p>
            </div>
<% if(currUser && listing.owner && currUser._id.equals(listing.owner._id)) { %>
    <div class="btns mt-4 mb-5 d-flex">
        <a href="/list/<%= listing._id %>/edit" class="btn btn-dark edit-btn px-4">Edit</a>
        <form method="POST" action="/list/<%= listing._id %>?_method=DELETE" class="ms-3">
            <button class="btn btn-outline-danger px-4">Delete</button>
        </form>
    </div>
<% } %>
          
            <hr/>
            <% if(currUser){%>
            <div class="mb-5">
                <form method="POST" action="/list/<%= listing._id %>/reviews" class="needs-validation" novalidate>
                    <div class="mb-3 mt-3">
                          <h5>Leave a Review:</h5>
                       <fieldset class="starability-basic">
  <input type="radio" id="no-rate" class="input-no-rate" name="review[rating]" value="0" checked aria-label="No rating." />
  <input type="radio" id="first-rate1" name="review[rating]" value="1" />
  <label for="first-rate1" title="Terrible">1 star</label>
  <input type="radio" id="first-rate2" name="review[rating]" value="2" />
  <label for="first-rate2" title="Not good">2 stars</label>
  <input type="radio" id="first-rate3" name="review[rating]" value="3" />
  <label for="first-rate3" title="Average">3 stars</label>
  <input type="radio" id="first-rate4" name="review[rating]" value="4" />
  <label for="first-rate4" title="Very good">4 stars</label>
  <input type="radio" id="first-rate5" name="review[rating]" value="5" />
  <label for="first-rate5" title="Amazing">5 stars</label>
</fieldset>
  <div class="invalid-feedback">Please add your rating.</div>
                    </div>
                    <div class="mb-3">
                        <label for="comment" class="form-label">Comments</label>
                        <textarea name="review[comment]" id="comment" rows="4" class="form-control" required></textarea> [cite: 8, 9]
                        <div class="invalid-feedback">Please add some comments for your review.</div>
                    </div>
                    <button class="btn btn-outline-light">Submit Review</button>
                </form>
            </div>

            <hr/> <% } %>

            <% if(listing.reviews && listing.reviews.length > 0) { %>
                <h4>All Reviews</h4>
                <div class="row mt-3">
                    <% for(let review of listing.reviews) { %>
                        <div class="card col-md-5 ms-md-3 mb-3 p-0 shadow-sm">
                            <div class="card-body">
                                <h6 class="card-title fw-bold" style="color: black;font-size: 1.1rem;"><%= review.author.username %></h6>
                                  <p class="starability-result card-text" data-rating=<%= review.rating %>></p>
                                <p class="card-text text-muted small"><%= review.comment %></p>
                               <% if(currUser && review.author && currUser._id.equals(review.author._id)) { %>
                <form method="POST" action="/list/<%= listing._id %>/reviews/<%= review._id %>?_method=DELETE">
                    <button class="btn btn-sm btn-dark">Delete</button>
                </form>  
            <% } %>
                            </div>
                        </div>
                    <% } %>
                </div>
            <% } else { %>
                <p class="text" style="color: rgb(255, 252, 252);font-size: 1.1rem;">No reviews yet. Be the first to leave one!</p>
            <% } %>
            </div>
    </div>
</div>

